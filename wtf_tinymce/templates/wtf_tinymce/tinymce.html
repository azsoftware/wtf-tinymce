{% macro append_tinymce_css() -%}
    <link href="{{ url_for('wtf_tinymce.static', filename='vendor/tinymce/js/tinymce/skins/lightgray/skin.min.css') }}"
          rel="stylesheet">
{% endmacro %}

{% macro append_tinymce_js() -%}
    <script src="{{ url_for('wtf_tinymce.static', filename='vendor/tinymce/js/tinymce/jquery.tinymce.min.js') }}"></script>
    <script src="{{ url_for('wtf_tinymce.static', filename='vendor/tinymce/js/tinymce/tinymce.min.js', v='4.4.0') }}"></script>

    {% for field in form -%}
        {%- if field.widget.input_type == 'tinymce' -%}
            {{ add_tinymce_editor(field) }}
        {%- endif %}
    {%- endfor %}
{% endmacro %}

{% macro add_tinymce_editor(field) -%}
  <script type="text/javascript">
    $(function() {
      $('textarea#{{ field.id }}').removeClass('richtext').tinymce({
        {%- for k, v in field.tinymce_options.items() %}
        {{ k|tojson }}: {{ v|tojson }},
        {%- endfor %}
        // Content CSS
        content_css: {{ (field.content_css or url_for('static', filename='css/tinymce.css'))|tojson }},
        // Focus/blur indicators
        setup: function(ed) {
          ed.on('focus', function(e) {
            $(ed.editorContainer).addClass('active');
          });
          ed.on('blur', function(e) {
            $(ed.editorContainer).removeClass('active');
          });
        } // End of setup keyval
      });
    });
  </script>
{% endmacro %}